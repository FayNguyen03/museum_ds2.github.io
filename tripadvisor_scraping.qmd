---
title: TripAdvisor API 
---

```{r}
library(httr)
```

```{r}
mn_museum <- read_csv('Data/museums_tidy.csv') |>
  filter(ADSTATE == 'MN')
```

```{r}
API_KEY = "024CD356E7014745A5893ECA15E3FD7F"
url <- "https://api.content.tripadvisor.com/api/v1/location/search"
```

```{r}
tripAdvisorAPI <- function(name, long, lat, state, postal) {

  
  queryString <- list(
    language = "en",
    key = API_KEY,
    searchQuery = name,
    latLong = str(lat) + str(long)
  )
  
  response <- GET(url, query = queryString, add_headers(Accept = "application/json"))
  
  if (http_error(response)) {
    stop("API request failed with status code: ", status_code(response))
  }
  
  detail <- content(response, type = "application/json")
  num_results <- length(detail$data)
  if (num_results == 0) {
    return(0)
  }
  for (i in seq_len(num_results)) {
    address_obj <- detail$data[[i]]$address_obj
    #print(address_obj)
    
    if (!is.na(address_obj$country)) {
      if(address_obj$country == "United States"){
      if (!is.na(address_obj$state)) {
        if(address_obj$state == state){
          return(detail$data[[i]]$location_id)
        }
      }
      
      else {
        if (!is.na(address_obj$postalcode) && substr(address_obj$postalcode, 1, 5) == postal) {
          return(detail$data[[i]]$location_id)
        }
      }
      }
    }
  }
  
  return(0)
}
```



```{r}
locations_mn <-tibble(name = mn_museum$COMMONNAME, lat = mn_museum$LATITUDE, long = mn_museum$LONGITUDE)
location_id <- double(length=length(mn_museum$COMMONNAME))
```

```{r}
for (i in 307:length(mn_museum$COMMONNAME)){
  location_id[i] <-as.numeric( tripAdvisorAPI(mn_museum$COMMONNAME[i], mn_museum$LONGITUDE[i], mn_museum$LATITUDE[i], "Minnesota",mn_museum$ADZIP5[i]))
  
}

```

```{r}
locations_mn <- locations_mn |> mutate(id_tripadvisor = location_id) 
```






