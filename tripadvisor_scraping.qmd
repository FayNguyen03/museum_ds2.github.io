---
title: TripAdvisor API 
---

```{r}
library(httr)
```

```{r}
mn_museum <- read_csv('Data/museums_tidy.csv') |>
  filter(ADSTATE == 'MN')
```

```{r}
API_KEY = "024CD356E7014745A5893ECA15E3FD7F"
url <- "https://api.content.tripadvisor.com/api/v1/location/search"
```

```{r}
tripAdvisorAPI <- function(name, long, lat, postal){
  queryString <- list(
    language = "en",
    key=API_KEY,
    searchQuery=name,
    latLong = paste(lat, long),
    radius = 0
  )

  response <- VERB("GET", url, query = queryString, content_type("application/octet-stream"), accept("application/json"))
  
  detail <- content(response, "parse")
  location_id <- 0  
  num_results <- length(detail$data)
  if (length(detail) == 0){
    return(0)
  }
  for (i in 1:num_results) {
    if (substr(detail$data[[i]]$address_obj$postalcode, 1, 5) == postal) {
      location_id <- detail$data[[i]]$location_id  
      break 
    }
  }

  return(location_id)
}

```

```{r}
#TEST
typeof(tripAdvisorAPI("BIRMINGHAM MUSEUM OF ART",33.52206,-86.80939,35203))
```

```{r}
locations_mn <-tibble(name = mn_museum$COMMONNAME, lat = mn_museum$LATITUDE, long = mn_museum$LONGITUDE)
location_id <- double()
```

```{r}
for (i in 1:length(mn_museum$COMMONNAME)){
  location_id[i] <- tripAdvisorAPI(mn_museum$COMMONNAME[[i]], mn_museum$LONGITUDE[[i]], mn_museum$LATITUDE[[i]], mn_museum$ADZIP5[[i]])
}

```

```{r}
locations_mn <- locations_mn |> mutate(id_tripadvisor = location_id) 
```






