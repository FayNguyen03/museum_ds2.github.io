---
title: "Museums"
output: 
  flexdashboard::flex_dashboard:
    theme:
      version: 4
      bg: "#101010"
      fg: "#FDF7F7" 
      primary: "#a9c5a0"
      navbar-bg: "#020402"
runtime: shiny
---

```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggspatial)
library(sf)
library(ggthemes)
library(dplyr)
library(cdlTools)
library(ggrepel)
library(gghighlight)
library(beepr)
library(tigris)
library(spData)
data(us_states)
library(raster)
library(tmap)
library(shiny)
library(flexdashboard)

museums <- read_csv("Data/museums_tidy.csv") 
museums_sf <- museums |> filter(!is.na(LONGITUDE)) |> filter(!is.na(LATITUDE)) |>  st_as_sf(coords = c("LONGITUDE", "LATITUDE"), remove = FALSE) |> st_set_crs(4326) |> st_transform(4269)
mn_sf <- st_read("Data/shp_bdry_counties_in_minnesota/mn_county_boundaries.shp") |> st_transform(4326)

counties <- st_read("Data/cb_2023_us_county_5m/cb_2023_us_county_5m.shp") |>
  # as.data.frame() |> 
  mutate(
    STATEFP = fips(STATEFP, to = 'Abbreviation')
  )

us_states <- us_states |> 
  mutate(
    ADSTATE = fips(GEOID, to = "Abbreviation")
  )

minneseum <- read_csv("Data/tripadvisor_data.csv")
```

# About

## Column {data-width = 200}

**Introduction**

![](img/museum1.jpg)

Food deserts are areas with limited to no access to nutrition. There have been many analyses of the food disparity globally and nationally, even manifesting in developed urban spaces like Chicago. Analyses have found an intimate relationship between food disparities and race.

Being inspired by these accounts, we were curious to see if there was such a thing as a museum desert. While they are not as essential as food, museums offer important educational information as well as being sources of entertainment. This is important as museums can offer insights from disciplines outside of oneâ€™s usual pursuits, offer a more specialised investigation of a certain topic, or provide information that are excluded by institutional bias. Are museums really impactful? Does having one near you improve the quality of life or of education? Who is likely to have access to a museum, and how costly would it be?

------------------------------------------------------------------------

**Data set Information**

There are 7 categories of museums regulated by the IMLS. For the `DISCIPLINE`, each code corresponds to a category

| CODE | DISCIPLINE                                  |
|------|---------------------------------------------|
| ART  | Art Museums                                 |
| CMU  | Children Museums                            |
| HST  | History Museums                             |
| NAT  | Natural History & Natural Science Museums   |
| SCI  | Science & Technology Museums & Planetariums |
| GMU  | Uncategorized or General Museums            |
| HSC  | Historic Preservation                       |


# Discipline Distribution

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
  selectInput(inputId = "unit", label = "Unit of Area:",
                choices = c("State", "AAMREG", "BEAREG", "LOCALE4"),
                selected = "State"),
  uiOutput("dynamicInput"),
  radioButtons(
      "discipline",
      label = "Discipline",
      choices = unique(museums$DISCIPLINE),
      selected = NULL,
      inline = FALSE,
      width = NULL,
      choiceNames = NULL,
      choiceValues = NULL
    )
)

```

```{r server, echo = FALSE}
inputPanel(
  dynamicInput <- renderUI({
    if (input$unit == "State") {
      selectInput("state", "State", choices = museums$ADSTATE, selected = "MN")
    } 
    else if (input$unit == "AAMREG") {
      selectInput("aamreg", "AAMREG", choices = museums$AAMREG , selected = "1")
    } 
    else if (input$unit == "BEAREG") {
      selectInput("beareg", "BEAREG", choices = museums$BEAREG, selected = "1")
    } 
    else if (input$unit == "LOCALE4") {
      selectInput("locale4", "LOCALE4", choices = museums$LOCALE4, selected = "1")
    }
  })
)
```

## Column

```{r, echo=FALSE}

renderPlot({
  if(input$unit == "State"){
    if (input$state != ""){
      discipline1 <- museums |> filter(ADSTATE == input$state)|>
      group_by(DISCIPLINE) |>
      summarize(n = n()) 
      title1 <- paste(toupper("Discipline Distribution in"),input$state)
    }
    else{
       discipline1 <- museums |>
        group_by(DISCIPLINE) |>
        summarize(n = n()) 
       regions
       title1 <- toupper("Discipline Distribution in the USA")
    }
  }
  else if (input$unit == "AAMREG"){
      discipline1 <- museums |> filter(AAMREG == input$aamreg)|>
      group_by(DISCIPLINE) |>
      summarize(n = n()) 
      aamreg <- c("New England", "Mid-Atlantic", "Southeastern", "Midwest", "Mountain Plains", "Western")
      title1 <- paste("Discipline Distribution in",aamreg[as.numeric(input$aamreg)],"region")
  }
  else if (input$unit == "BEAREG"){
      discipline1 <- museums |> filter(BEAREG == input$beareg)|>
      group_by(DISCIPLINE) |>
      summarize(n = n()) 
      beareg <- c("New England", "Mid-East", "Great Lakes", "Plains", "Southest", "Southwest", "Rocky Mountains", "Far West")
      title1 <- paste("Discipline Distribution in",beareg[as.numeric(input$beareg)],"region")
  }
  else if (input$unit == "LOCALE4"){
      discipline1 <- museums |> filter(LOCALE4 == input$locale4)|>
      group_by(DISCIPLINE) |>
      summarize(n = n()) 
      aamreg <- c("City", "Suburb", "Town", "Rural")
      title1 <- paste("Discipline Distribution in",aamreg[as.numeric(input$locale4)],"territories")
  }
    discipline1|>
    ggplot(aes(x = fct_reorder(DISCIPLINE,n), y = n)) +
    geom_col(aes(fill = DISCIPLINE)) +
    coord_flip(xlim = NULL, ylim = NULL, expand = TRUE, clip = "on")+
    labs(x = "Number of Organizations", y = "Discipline", title = title1) +
    theme_minimal()
})
```




# Maps

## Inputs {.sidebar}

```{r, echo=FALSE}
inputPanel(
  selectInput("input_var", label = "Number of museums by:",
              choices = c("State", "Population", "Area"), selected = "State"),
  
  sliderInput("bw_adjust2", label = "Bandwidth adjustment:",
              min = 0.1, max = 3, value = 1.2, step = 0.1),
  
  selectInput("input_state", label = "State:",
              choices = c(as.character(us_states$ADSTATE)), selected = "MN")
)
  
```


```{r, echo=FALSE}
  inputPanel(
    selectInput("input_county", label = "County:",
              choices = c("", filter(counties, STATEFP == "MN")$NAME), selected = "All"),
)
reactive({
          updateSelectInput(session, "input_county", choices = c("", filter(counties, STATEFP == input$input_state)$NAME), selected = "")
    })

```

## Column

```{r, echo=FALSE}
renderPlot({
  museums |> 
  count(ADSTATE) |> 
  rename(State = n) |>
  left_join(us_states) |> 
  mutate(
    Population = State / (total_pop_15 / as.numeric(AREA)),
    Area = log(State / as.numeric(AREA)),
  ) |> 
  st_as_sf() |> 
  ggplot() +
  geom_sf(aes_string(fill = input$input_var))
})
```


```{r, echo=FALSE}
renderPlot({
  state_var = input$input_state
county_var = input$input_county
state_sf = counties |> 
  filter(STATEFP == state_var)
if (county_var != "") {
  state_sf = state_sf |> 
    filter(NAME == county_var) 
}
museums_sf |>
  filter(ADSTATE == state_var) |>
  st_intersection(state_sf) |> 
ggplot() +
  geom_sf(data = state_sf) +
  geom_sf(size = 0.1) +
  labs(
    title = str_c("Museums in ", county_var, " ", state_var)
  ) +
  theme_map()
})

beep()
```

Moran's I of counties
Point-pattern analysis density analysis
household_income
population_change
zip codes

# Explore

```{r echo = FALSE}
tmap_mode("view")
tm_shape(museums_sf) +
  tm_dots(col = "DISCIPLINE", shape = "DISCIPLINE", alpha = 0.5, size = 0.1)

```

# Minneseums

Make interactive map of MN for Fay's Tripadvisor

```{r}
tmap_mode("view")

# Create the map
museums_map <- museums_sf |> 
  filter(ADSTATE == "MN") |> 
  tm_shape() +
  tm_dots(
    col = "DISCIPLINE", 
    shape = "DISCIPLINE", 
    alpha = 0.5, 
    size = 0.1
  ) +
  tm_shape(st_union(mn_sf)) + 
  tm_borders(col = "black", lwd = 3)

museums_map
```

# Limitations

